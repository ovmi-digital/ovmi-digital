---
const navLinks = [
  { label: "About", href: "#about" },
  { label: "Services", href: "#services" },
  { label: "Process", href: "#process" },
  { label: "Work", href: "#work" },
  { label: "Contact", href: "#contact" },
];
---

<!-- Desktop nav rail -->
<nav
  class="fixed top-0 right-0 h-screen w-20 z-40
         hidden lg:flex flex-col items-end justify-between py-8 pr-6"
  aria-label="Section navigation"
>
  <!-- Theme toggle -->
  <button
    id="theme-toggle"
    type="button"
    aria-label="Toggle dark mode"
    class="w-10 h-10 flex items-center justify-center
           text-[var(--color-muted)] hover:text-[var(--color-text)]
           dark:text-[var(--color-muted-dark)] dark:hover:text-[var(--color-text-dark)]
           transition-colors cursor-pointer"
  >
    <svg class="dark:hidden" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
      <circle cx="10" cy="10" r="4" />
      <path d="M10 2v2M10 16v2M2 10h2M16 10h2M4.93 4.93l1.41 1.41M13.66 13.66l1.41 1.41M4.93 15.07l1.41-1.41M13.66 6.34l1.41-1.41" />
    </svg>
    <svg class="hidden dark:block" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.003 8.003 0 1010.586 10.586z" />
    </svg>
  </button>

  <!-- Section links -->
  <ul class="flex flex-col items-end gap-6">
    {navLinks.map((link) => (
      <li>
        <a
          href={link.href}
          class="side-nav-link text-[0.65rem] font-bold uppercase tracking-[0.15em]
                 text-[var(--color-muted)] dark:text-[var(--color-muted-dark)]
                 hover:text-[var(--color-text)] dark:hover:text-[var(--color-text-dark)]
                 transition-colors"
          data-section={link.href.slice(1)}
        >
          {link.label}
        </a>
      </li>
    ))}
  </ul>

  <!-- Email -->
  <a
    href="mailto:hello@ovmi.tech"
    class="text-sm font-bold tracking-wider
           text-[var(--color-muted)] dark:text-[var(--color-muted-dark)]
           hover:text-[var(--color-accent)] dark:hover:text-[var(--color-accent-dark)]
           transition-colors [writing-mode:vertical-rl] rotate-180"
  >
    hello@ovmi.tech
  </a>
</nav>

<!-- Mobile hamburger button -->
<button
  id="mobile-menu-toggle"
  type="button"
  aria-label="Open menu"
  class="fixed top-6 right-6 z-50 w-10 h-10
         flex lg:hidden items-center justify-center
         text-[var(--color-muted)] hover:text-[var(--color-text)]
         dark:text-[var(--color-muted-dark)] dark:hover:text-[var(--color-text-dark)]
         transition-colors cursor-pointer"
>
  <svg id="hamburger-icon" width="22" height="22" viewBox="0 0 22 22" fill="none" stroke="currentColor" stroke-width="1.5">
    <path d="M3 6h16M3 11h16M3 16h16" />
  </svg>
  <svg id="close-icon" class="hidden" width="22" height="22" viewBox="0 0 22 22" fill="none" stroke="currentColor" stroke-width="1.5">
    <path d="M5 5l12 12M17 5L5 17" />
  </svg>
</button>

<!-- Mobile overlay -->
<div
  id="mobile-menu"
  class="fixed inset-0 z-40 hidden
         bg-[var(--color-bg)] dark:bg-[var(--color-bg-dark)]
         flex-col items-center justify-center gap-8"
>
  <ul class="flex flex-col items-center gap-6">
    {navLinks.map((link) => (
      <li>
        <a
          href={link.href}
          class="mobile-nav-link text-2xl font-bold uppercase tracking-[0.1em]
                 text-[var(--color-text)] dark:text-[var(--color-text-dark)]
                 hover:text-[var(--color-accent)] dark:hover:text-[var(--color-accent-dark)]
                 transition-colors"
        >
          {link.label}
        </a>
      </li>
    ))}
  </ul>

  <a
    href="mailto:hello@ovmi.tech"
    class="text-sm font-bold
           text-[var(--color-accent)] dark:text-[var(--color-accent-dark)]
           hover:opacity-70 transition-opacity"
  >
    hello@ovmi.tech
  </a>

  <!-- Theme toggle in mobile menu -->
  <button
    id="mobile-theme-toggle"
    type="button"
    aria-label="Toggle dark mode"
    class="w-10 h-10 flex items-center justify-center
           text-[var(--color-muted)] hover:text-[var(--color-text)]
           dark:text-[var(--color-muted-dark)] dark:hover:text-[var(--color-text-dark)]
           transition-colors cursor-pointer"
  >
    <svg class="dark:hidden" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
      <circle cx="10" cy="10" r="4" />
      <path d="M10 2v2M10 16v2M2 10h2M16 10h2M4.93 4.93l1.41 1.41M13.66 13.66l1.41 1.41M4.93 15.07l1.41-1.41M13.66 6.34l1.41-1.41" />
    </svg>
    <svg class="hidden dark:block" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
      <path d="M17.293 13.293A8 8 0 016.707 2.707a8.003 8.003 0 1010.586 10.586z" />
    </svg>
  </button>
</div>

<script is:inline>
  // Theme toggle (both desktop and mobile buttons)
  function toggleTheme() {
    const isDark = document.documentElement.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }
  document.getElementById("theme-toggle").addEventListener("click", toggleTheme);
  document.getElementById("mobile-theme-toggle").addEventListener("click", toggleTheme);

  // Mobile menu open/close
  const menuToggle = document.getElementById("mobile-menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const hamburgerIcon = document.getElementById("hamburger-icon");
  const closeIcon = document.getElementById("close-icon");

  function openMenu() {
    mobileMenu.classList.remove("hidden");
    mobileMenu.classList.add("flex");
    hamburgerIcon.classList.add("hidden");
    closeIcon.classList.remove("hidden");
    document.documentElement.style.overflow = "hidden";
    menuToggle.setAttribute("aria-label", "Close menu");
  }

  function closeMenu() {
    mobileMenu.classList.add("hidden");
    mobileMenu.classList.remove("flex");
    hamburgerIcon.classList.remove("hidden");
    closeIcon.classList.add("hidden");
    document.documentElement.style.overflow = "";
    menuToggle.setAttribute("aria-label", "Open menu");
  }

  menuToggle.addEventListener("click", function () {
    var isOpen = !mobileMenu.classList.contains("hidden");
    isOpen ? closeMenu() : openMenu();
  });

  // Close mobile menu when clicking a nav link
  mobileMenu.querySelectorAll(".mobile-nav-link").forEach(function (link) {
    link.addEventListener("click", closeMenu);
  });

  // Active section tracking (desktop only)
  var sections = ["about", "services", "process", "work", "contact"];
  var navLinksEls = document.querySelectorAll(".side-nav-link");

  var observer = new IntersectionObserver(
    function (entries) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          var id = entry.target.id;
          navLinksEls.forEach(function (link) {
            if (link.dataset.section === id) {
              link.classList.remove(
                "text-[var(--color-muted)]",
                "dark:text-[var(--color-muted-dark)]"
              );
              link.classList.add(
                "text-[var(--color-accent)]",
                "dark:text-[var(--color-accent-dark)]"
              );
            } else {
              link.classList.remove(
                "text-[var(--color-accent)]",
                "dark:text-[var(--color-accent-dark)]"
              );
              link.classList.add(
                "text-[var(--color-muted)]",
                "dark:text-[var(--color-muted-dark)]"
              );
            }
          });
        }
      });
    },
    { rootMargin: "-40% 0px -40% 0px", threshold: 0 }
  );

  sections.forEach(function (id) {
    var el = document.getElementById(id);
    if (el) observer.observe(el);
  });
</script>
